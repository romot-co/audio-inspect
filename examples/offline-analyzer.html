<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audio Inspect - Offline Analysis Studio</title>
  <style>
    :root {
      --bg-deep: #0b1722;
      --bg-mid: #102433;
      --surface: #f4efe3;
      --surface-strong: #ffffff;
      --ink: #162331;
      --muted: #4d5f6f;
      --brand: #0a6d8f;
      --brand-soft: #d8eef5;
      --accent: #e78a2f;
      --ok: #1f9d5a;
      --warn: #ad6d00;
      --bad: #b83434;
      --shadow: 0 24px 50px rgba(6, 12, 20, 0.28);
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-sm: 8px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Avenir Next", "Trebuchet MS", "Segoe UI", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(circle at 10% 15%, rgba(231, 138, 47, 0.24), transparent 38%),
        radial-gradient(circle at 78% 8%, rgba(10, 109, 143, 0.34), transparent 30%),
        linear-gradient(160deg, var(--bg-deep), var(--bg-mid));
      padding: 28px 16px 40px;
    }

    .shell {
      width: min(1220px, 100%);
      margin: 0 auto;
      display: grid;
      gap: 18px;
    }

    .hero {
      background: linear-gradient(125deg, rgba(255, 255, 255, 0.94), rgba(244, 239, 227, 0.96));
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      padding: 28px;
      position: relative;
      overflow: hidden;
    }

    .hero::after {
      content: "";
      position: absolute;
      right: -48px;
      top: -28px;
      width: 180px;
      height: 180px;
      border-radius: 999px;
      background: radial-gradient(circle at 35% 30%, rgba(10, 109, 143, 0.24), rgba(10, 109, 143, 0));
      pointer-events: none;
    }

    .hero h1 {
      margin: 0;
      font-family: "Palatino Linotype", "Book Antiqua", Georgia, serif;
      font-size: clamp(1.7rem, 3vw, 2.35rem);
      letter-spacing: 0.02em;
      color: #112638;
    }

    .hero p {
      margin: 10px 0 0;
      line-height: 1.55;
      color: var(--muted);
      max-width: 840px;
    }

    .workspace {
      display: grid;
      grid-template-columns: minmax(280px, 340px) minmax(0, 1fr);
      gap: 18px;
    }

    .panel {
      border-radius: var(--radius-lg);
      background: var(--surface);
      box-shadow: var(--shadow);
      padding: 20px;
    }

    .controls h2,
    .preview h2,
    .results h2 {
      margin: 0;
      font-family: "Palatino Linotype", "Book Antiqua", Georgia, serif;
      font-size: 1.25rem;
      color: #15283a;
    }

    .controls {
      display: grid;
      gap: 16px;
      align-content: start;
    }

    .field {
      display: grid;
      gap: 8px;
    }

    .field label,
    .section-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #365164;
      font-weight: 700;
    }

    .field input[type="file"],
    .field select,
    .field input[type="number"] {
      width: 100%;
      border: 1px solid #bfd3de;
      border-radius: var(--radius-sm);
      padding: 10px 12px;
      font: inherit;
      color: #193145;
      background: var(--surface-strong);
    }

    .inline-fields {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .checks {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      max-height: 260px;
      overflow: auto;
      padding: 2px 3px 2px 0;
    }

    .checks label {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.94rem;
      color: #253e51;
      background: rgba(255, 255, 255, 0.68);
      border: 1px solid #d2e1e8;
      border-radius: var(--radius-sm);
      padding: 8px 10px;
    }

    .checks input {
      width: 15px;
      height: 15px;
      accent-color: var(--brand);
    }

    .button-row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .button-row button {
      border: 0;
      border-radius: 10px;
      padding: 11px 14px;
      font: inherit;
      font-weight: 700;
      cursor: pointer;
      transition: transform 140ms ease, box-shadow 140ms ease, opacity 140ms ease;
    }

    .button-row button:active {
      transform: translateY(1px);
    }

    .primary-btn {
      background: linear-gradient(135deg, #0d789c, #0a5f7c);
      color: #eff9fd;
      box-shadow: 0 10px 20px rgba(10, 109, 143, 0.22);
    }

    .secondary-btn {
      background: linear-gradient(135deg, #f0d3b4, #e9b57f);
      color: #3c2510;
      box-shadow: 0 10px 20px rgba(140, 79, 20, 0.18);
    }

    .button-row button:disabled {
      opacity: 0.45;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .preview {
      display: grid;
      gap: 14px;
    }

    .meta-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
    }

    .meta-card {
      background: var(--surface-strong);
      border: 1px solid #d8e7ec;
      border-radius: var(--radius-sm);
      padding: 10px;
    }

    .meta-card dt {
      margin: 0;
      font-size: 0.75rem;
      color: #516a7b;
      text-transform: uppercase;
      letter-spacing: 0.07em;
    }

    .meta-card dd {
      margin: 6px 0 0;
      color: #173244;
      font-weight: 700;
      font-size: 0.95rem;
    }

    .player-box {
      background: var(--surface-strong);
      border: 1px solid #d8e7ec;
      border-radius: var(--radius-sm);
      padding: 10px;
    }

    audio {
      width: 100%;
      display: block;
    }

    .canvas-wrap {
      background: #10202d;
      border-radius: var(--radius-sm);
      border: 1px solid #1f3f52;
      padding: 8px;
    }

    .canvas-wrap h3 {
      margin: 0 0 6px;
      font-size: 0.8rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #9cc7d9;
      font-weight: 700;
    }

    canvas {
      width: 100%;
      height: 150px;
      display: block;
      border-radius: 6px;
      background: linear-gradient(180deg, #142736, #0e1d2a);
    }

    .results {
      display: grid;
      gap: 12px;
    }

    .results-head {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .summary-text {
      color: #39586b;
      font-size: 0.9rem;
    }

    .status-line {
      border-radius: var(--radius-sm);
      padding: 8px 10px;
      font-size: 0.93rem;
      background: #edf7fb;
      color: #1f4f64;
      border: 1px solid #cde4ef;
    }

    .status-line.warn {
      background: #fff5e7;
      color: #845100;
      border-color: #f2d8a7;
    }

    .status-line.error {
      background: #ffeceb;
      color: #8c2424;
      border-color: #f3c4c1;
    }

    .progress-shell {
      height: 8px;
      border-radius: 999px;
      overflow: hidden;
      background: #d7e6ed;
    }

    .progress-bar {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #0d789c, #e78a2f);
      transition: width 240ms ease;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 12px;
    }

    .result-card {
      background: var(--surface-strong);
      border: 1px solid #d8e7ec;
      border-radius: var(--radius-md);
      padding: 12px;
      opacity: 0;
      transform: translateY(8px);
      animation: reveal 300ms ease forwards;
      animation-delay: var(--delay, 0ms);
    }

    .result-card.ok {
      border-top: 3px solid var(--ok);
    }

    .result-card.error {
      border-top: 3px solid var(--bad);
    }

    .result-card h3 {
      margin: 0;
      font-size: 1rem;
      color: #153248;
    }

    .result-meta {
      margin: 4px 0 10px;
      color: #5c7586;
      font-size: 0.82rem;
    }

    .result-body {
      display: grid;
      gap: 5px;
      font-size: 0.9rem;
      color: #244052;
    }

    .result-body .metric {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      border-bottom: 1px dashed #e2edf2;
      padding-bottom: 3px;
    }

    .result-body .metric span:first-child {
      color: #4f6878;
    }

    details {
      border: 1px solid #d8e7ec;
      border-radius: var(--radius-sm);
      background: rgba(255, 255, 255, 0.78);
    }

    summary {
      cursor: pointer;
      padding: 10px;
      font-weight: 700;
      color: #2f4d5f;
      user-select: none;
    }

    pre {
      margin: 0;
      max-height: 340px;
      overflow: auto;
      padding: 10px;
      border-top: 1px solid #d8e7ec;
      background: #f9fcfd;
      color: #1f3848;
      font: 12px/1.5 "IBM Plex Mono", "Courier New", monospace;
    }

    @keyframes reveal {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 980px) {
      .workspace {
        grid-template-columns: 1fr;
      }

      .meta-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      body {
        padding: 14px 10px 22px;
      }

      .hero,
      .panel {
        padding: 14px;
      }

      .meta-grid {
        grid-template-columns: 1fr;
      }

      canvas {
        height: 124px;
      }
    }
  </style>
</head>
<body>
  <main class="shell">
    <section class="hero">
      <h1>Offline Analysis Studio</h1>
      <p>
        Upload a WAV file and run targeted analyses from the audio-inspect library. This page is file-first,
        non-realtime, and designed for inspecting quality, spectral balance, loudness, and speech structure.
      </p>
    </section>

    <section class="workspace">
      <form id="controlForm" class="panel controls" autocomplete="off">
        <h2>Configuration</h2>

        <div class="field">
          <label for="fileInput">WAV File</label>
          <input id="fileInput" type="file" accept=".wav,audio/wav,audio/x-wav" required>
        </div>

        <div class="inline-fields">
          <div class="field">
            <label for="channelMode">Channel Mode</label>
            <select id="channelMode">
              <option value="original">Original</option>
              <option value="mono">Mono</option>
              <option value="stereo">Stereo</option>
            </select>
          </div>

          <div class="field">
            <label for="targetSampleRate">Sample Rate</label>
            <select id="targetSampleRate">
              <option value="native">Native</option>
              <option value="16000">16000 Hz</option>
              <option value="44100">44100 Hz</option>
              <option value="48000">48000 Hz</option>
            </select>
          </div>
        </div>

        <div class="inline-fields">
          <div class="field">
            <label for="fftSize">FFT Size</label>
            <select id="fftSize">
              <option value="1024">1024</option>
              <option value="2048" selected>2048</option>
              <option value="4096">4096</option>
            </select>
          </div>

          <div class="field">
            <label for="peakThreshold">Peak Threshold</label>
            <input id="peakThreshold" type="number" min="0" max="1" step="0.01" value="0.12">
          </div>
        </div>

        <div class="field">
          <label>
            <input id="normalizeInput" type="checkbox" checked>
            Normalize input before analysis
          </label>
        </div>

        <div class="field">
          <div class="section-title">Analyses</div>
          <div class="checks" id="analysisChecks">
            <label><input type="checkbox" data-analysis="rms" checked> RMS / Peak / Crest</label>
            <label><input type="checkbox" data-analysis="peaks" checked> Peak Detection</label>
            <label><input type="checkbox" data-analysis="energy" checked> Frame Energy</label>
            <label><input type="checkbox" data-analysis="spectrum" checked> Spectrum</label>
            <label><input type="checkbox" data-analysis="spectral" checked> Spectral Features</label>
            <label><input type="checkbox" data-analysis="lufs" checked> Loudness (LUFS)</label>
            <label><input type="checkbox" data-analysis="vad" checked> VAD</label>
            <label><input type="checkbox" data-analysis="stereo" checked> Stereo Image</label>
            <label><input type="checkbox" data-analysis="mfcc"> MFCC</label>
          </div>
        </div>

        <div class="button-row">
          <button id="analyzeBtn" class="primary-btn" type="submit" disabled>Run Selected Analyses</button>
          <button id="clearBtn" class="secondary-btn" type="button">Clear Results</button>
        </div>
      </form>

      <section class="panel preview" aria-live="polite">
        <h2>Preview</h2>

        <dl class="meta-grid" id="metaGrid">
          <div class="meta-card"><dt>File</dt><dd id="metaFile">-</dd></div>
          <div class="meta-card"><dt>Duration</dt><dd id="metaDuration">-</dd></div>
          <div class="meta-card"><dt>Sample Rate</dt><dd id="metaRate">-</dd></div>
          <div class="meta-card"><dt>Channels</dt><dd id="metaChannels">-</dd></div>
        </dl>

        <div class="player-box">
          <audio id="audioPlayer" controls preload="metadata"></audio>
        </div>

        <div class="canvas-wrap">
          <h3>Waveform</h3>
          <canvas id="waveformCanvas" width="1200" height="300"></canvas>
        </div>

        <div class="canvas-wrap">
          <h3>Spectrum Snapshot</h3>
          <canvas id="spectrumCanvas" width="1200" height="300"></canvas>
        </div>
      </section>
    </section>

    <section class="panel results">
      <div class="results-head">
        <h2>Results</h2>
        <div id="runSummary" class="summary-text">No analysis yet.</div>
      </div>
      <div id="statusLine" class="status-line">Select a WAV file to begin.</div>
      <div class="progress-shell"><div id="progressBar" class="progress-bar"></div></div>
      <div id="resultGrid" class="result-grid"></div>

      <details>
        <summary>Raw JSON Output</summary>
        <pre id="rawJson">{}</pre>
      </details>
    </section>
  </main>

  <script type="module" src="./offline-analyzer.js"></script>
</body>
</html>
